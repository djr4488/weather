<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather React Globe 3d</title>
  <style> body { margin: 0; } </style>

  <script src="//unpkg.com/react/umd/react.production.min.js"></script>
  <script src="//unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
  <script src="//unpkg.com/@babel/standalone"></script>

  <script src="https://unpkg.com/react-globe.gl"></script>
</head>
<body>
<div id="globeViz"></div>

<script type="text/jsx">
  const { useState, useEffect } = React;

  const World = () => {
    const [places, setPlaces] = useState([]);

    useEffect(() => {
      // load data
      fetch("/api/2.0/globeHour", {
        method: "GET",
        headers: {
          "Accept": "application/json"
        }
      })
      .then(res => res.json())
      .then(({ features }) => {
        setPlaces(features);
      }
      )}, []);

    return <Globe
            globeImageUrl="../../images/The_earth_at_night.jpg"
            backgroundImageUrl="//unpkg.com/three-globe/example/img/night-sky.png"

            labelsData={places}
            labelLat={d => d.properties.latitude}
            labelLng={d => d.properties.longitude}
            labelText={d => d.properties.name + "(" + d.properties.temperature + ")"}
            labelSize={d => .25}
            labelDotRadius={d => .25}
            labelColor={() => 'rgba(255, 165, 0, 0.75)'}
            labelResolution={2}
            onLabelClick={d => doClick(d.label, event, {lat: d.properties.latitude, lon: d.properties.longitude, altitude: .5})}
    />;
  };

  function doClick(l, e, loc) {
    console.log(loc);
  }

  ReactDOM.render(
          <World />,
          document.getElementById('globeViz')
  );
</script>
</body>
</html>